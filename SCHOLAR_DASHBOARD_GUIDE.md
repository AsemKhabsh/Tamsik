# دليل لوحة تحكم العالم - Scholar Dashboard Guide

## نظرة عامة

تم إنشاء نظام متكامل للعلماء لإدارة الأسئلة الموجهة لهم والإجابة عليها مباشرة من خلال لوحة تحكم خاصة.

---

## المميزات الرئيسية

### 1. **لوحة التحكم الرئيسية**
- عرض إحصائيات شاملة للأسئلة (الإجمالي، قيد الانتظار، المجابة، المسودات)
- عرض آخر الأسئلة قيد الانتظار
- عرض آخر الإجابات المنشورة
- إجراءات سريعة للوصول السريع

### 2. **إدارة الأسئلة**
- عرض جميع الأسئلة الموجهة للعالم
- تصفية الأسئلة حسب الحالة:
  - **الكل**: جميع الأسئلة
  - **قيد الانتظار**: أسئلة لم يتم الرد عليها
  - **تم الرد عليها**: أسئلة منشورة
  - **المسودات**: إجابات محفوظة لكن غير منشورة

### 3. **الإجابة على الأسئلة**
- واجهة سهلة للإجابة على الأسئلة
- إضافة المراجع والمصادر
- إضافة الوسوم (Tags)
- خيار النشر المباشر أو الحفظ كمسودة
- تعديل الإجابات المنشورة
- نشر/إلغاء نشر الإجابات

---

## المسارات (Routes)

### المسارات الرئيسية:

```php
// لوحة التحكم الرئيسية
GET /scholar/dashboard

// قائمة الأسئلة
GET /scholar/questions
GET /scholar/questions?status=pending
GET /scholar/questions?status=answered
GET /scholar/questions?status=draft

// عرض سؤال محدد
GET /scholar/questions/{id}

// الإجابة على سؤال
POST /scholar/questions/{id}/answer

// تحديث إجابة
PUT /scholar/questions/{id}/update

// نشر إجابة
PUT /scholar/questions/{id}/publish

// إلغاء نشر إجابة
PUT /scholar/questions/{id}/unpublish
```

---

## الصلاحيات

### متطلبات الوصول:
- يجب أن يكون المستخدم مسجل دخول (`auth` middleware)
- يجب أن يكون المستخدم عالماً:
  - `hasRole('scholar')` أو
  - `user_type === 'scholar'`

### الوصول إلى لوحة العالم:
يمكن للعالم الوصول إلى لوحته من خلال:
1. القائمة المنسدلة في الشريط العلوي (أيقونة المستخدم)
2. الرابط المباشر: `/scholar/dashboard`

---

## الملفات المضافة/المعدلة

### Controllers:
- ✅ `app/Http/Controllers/ScholarDashboardController.php` (جديد)

### Services:
- ✅ `app/Services/FatwaService.php` (تم التحديث)
  - `getScholarQuestions()` - جلب أسئلة العالم
  - `getScholarQuestionsStats()` - إحصائيات أسئلة العالم
  - `getScholarQuestion()` - جلب سؤال واحد للعالم

### Models:
- ✅ `app/Models/Fatwa.php` (تم التحديث)
  - إضافة علاقة `questioner()`

### Views:
- ✅ `resources/views/scholar/layout.blade.php` (جديد)
- ✅ `resources/views/scholar/dashboard.blade.php` (جديد)
- ✅ `resources/views/scholar/questions/index.blade.php` (جديد)
- ✅ `resources/views/scholar/questions/show.blade.php` (جديد)

### Routes:
- ✅ `routes/web.php` (تم التحديث)

### Layouts:
- ✅ `resources/views/layouts/app.blade.php` (تم التحديث)
  - إضافة رابط لوحة العالم في القائمة المنسدلة

---

## كيفية الاستخدام

### للعالم:

#### 1. الوصول إلى لوحة التحكم:
```
1. تسجيل الدخول
2. النقر على اسم المستخدم في الشريط العلوي
3. اختيار "لوحة العالم"
```

#### 2. عرض الأسئلة قيد الانتظار:
```
1. من لوحة التحكم، النقر على "قيد الانتظار" في الشريط الجانبي
2. أو النقر على بطاقة "قيد الانتظار" في الإحصائيات
```

#### 3. الإجابة على سؤال:
```
1. اختيار السؤال من القائمة
2. النقر على "الرد على السؤال"
3. كتابة الإجابة (الحد الأدنى 50 حرفاً)
4. إضافة المراجع والوسوم (اختياري)
5. اختيار:
   - ✅ نشر الإجابة مباشرة
   - أو حفظها كمسودة
6. النقر على "حفظ الإجابة"
```

#### 4. تعديل إجابة منشورة:
```
1. اختيار السؤال من قائمة "تم الرد عليها"
2. النقر على "تعديل الإجابة"
3. تعديل النص
4. حفظ التغييرات
```

#### 5. إلغاء نشر إجابة:
```
1. اختيار السؤال من قائمة "تم الرد عليها"
2. النقر على "إلغاء النشر"
3. تأكيد الإجراء
```

---

## حالات الأسئلة

### 1. **قيد الانتظار** (Pending)
- السؤال لم يتم الرد عليه بعد
- `is_published = false`
- `answer = null` أو `answer = ''`

### 2. **مسودة** (Draft)
- تم كتابة إجابة لكن لم يتم نشرها
- `is_published = false`
- `answer != null` و `answer != ''`

### 3. **منشور** (Published)
- تم نشر الإجابة
- `is_published = true`
- `answer != null`
- `published_at` يحتوي على تاريخ النشر

---

## الإحصائيات

### البيانات المعروضة:
- **إجمالي الأسئلة**: جميع الأسئلة الموجهة للعالم
- **قيد الانتظار**: الأسئلة التي تحتاج إلى إجابة
- **تم الرد عليها**: الأسئلة المنشورة
- **المسودات**: الإجابات المحفوظة لكن غير منشورة

---

## التصميم والواجهة

### الألوان:
- **الأساسي**: `#1d8a4e` (أخضر)
- **الثانوي**: `#0f7346` (أخضر داكن)
- **قيد الانتظار**: `#ffc107` (أصفر)
- **منشور**: `#28a745` (أخضر)
- **مسودة**: `#17a2b8` (أزرق فاتح)

### المكونات:
- **Sidebar**: قائمة جانبية ثابتة
- **Top Bar**: شريط علوي يعرض العنوان والتاريخ
- **Stat Cards**: بطاقات الإحصائيات
- **Question Cards**: بطاقات الأسئلة

---

## الأمان

### الحماية المطبقة:
1. **Authentication**: جميع المسارات محمية بـ `auth` middleware
2. **Authorization**: التحقق من صلاحية العالم في الـ Controller
3. **CSRF Protection**: جميع النماذج محمية بـ CSRF token
4. **Validation**: التحقق من صحة البيانات المدخلة
5. **Query Scoping**: العالم يرى أسئلته فقط (`scholar_id = Auth::id()`)

---

## الاختبار

### خطوات الاختبار:

#### 1. اختبار الوصول:
```
✅ تسجيل دخول كعالم
✅ الوصول إلى /scholar/dashboard
✅ التحقق من عرض الإحصائيات
```

#### 2. اختبار عرض الأسئلة:
```
✅ عرض جميع الأسئلة
✅ تصفية حسب الحالة
✅ التحقق من عرض الأسئلة الخاصة بالعالم فقط
```

#### 3. اختبار الإجابة:
```
✅ الإجابة على سؤال جديد
✅ حفظ كمسودة
✅ نشر الإجابة
✅ تعديل إجابة موجودة
✅ إلغاء نشر إجابة
```

#### 4. اختبار الصلاحيات:
```
✅ محاولة الوصول كمستخدم عادي (يجب أن يُرفض)
✅ محاولة عرض سؤال لعالم آخر (يجب أن يُرفض)
```

---

## الملاحظات المهمة

1. **العالم يرى أسئلته فقط**: النظام يعرض فقط الأسئلة التي `scholar_id` فيها يساوي معرف العالم المسجل دخوله

2. **الحد الأدنى للإجابة**: 50 حرفاً

3. **المسودات**: يمكن حفظ الإجابة كمسودة والعودة لها لاحقاً

4. **النشر**: عند نشر الإجابة، يتم تحديث `published_at` تلقائياً

5. **التعديل**: يمكن تعديل الإجابات المنشورة في أي وقت

---

## التطوير المستقبلي

### اقتراحات للتحسين:
- [ ] إضافة محرر نصوص غني (Rich Text Editor)
- [ ] إضافة إشعارات للعالم عند وصول أسئلة جديدة
- [ ] إضافة إحصائيات متقدمة (مشاهدات، إعجابات، إلخ)
- [ ] إضافة نظام تقييم للإجابات
- [ ] إضافة إمكانية رفض أسئلة غير مناسبة
- [ ] إضافة نظام بحث متقدم في الأسئلة
- [ ] إضافة تصدير الإجابات (PDF, Word)

---

## الدعم الفني

في حالة وجود مشاكل أو استفسارات:
1. التحقق من صلاحيات المستخدم
2. التحقق من وجود `scholar_id` في جدول `fatwas`
3. مراجعة ملف الـ logs: `storage/logs/laravel.log`

---

**تاريخ الإنشاء**: 2025-10-25  
**الإصدار**: 1.0  
**الحالة**: ✅ جاهز للاستخدام


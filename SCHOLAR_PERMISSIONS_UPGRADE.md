# ๐ ุชุฑููุฉ ุตูุงุญูุงุช ุงูุนุงูู (Scholar Permissions Upgrade)
## ููุตุฉ ุชูุณูู - Tamsik Platform

**ุงูุชุงุฑูุฎ:** 2025-10-25  
**ุงูุญุงูุฉ:** โ ููุชูู  
**ุงูุฃููููุฉ:** ๐ข ุชุญุณูู

---

## ๐ ุงููุฏู

**ููุญ ุงูุนุงูู (Scholar) ุฌููุน ุตูุงุญูุงุช ุงูุฎุทูุจ (Preacher) + ุตูุงุญูุงุช ุฅุถุงููุฉ**

### ุงูููุทู:
- **ุงูุนุงูู** = ุฎุทูุจ + ูููู + ููุชู
- **ุงูุฎุทูุจ** = ูุชุฎุตุต ูู ุงูุฎุทุจ ูุงููุญุงุถุฑุงุช ููุท
- **ุงูุนุงูู** ูุฌุจ ุฃู ูููู ูุงุฏุฑุงู ุนูู ูุนู ูู ูุง ููุนูู ุงูุฎุทูุจ + ุงููุฒูุฏ

---

## ๐ฏ ุงูุตูุงุญูุงุช ุงูุญุงููุฉ

### 1๏ธโฃ ุตูุงุญูุงุช ุงูุฎุทูุจ (Preacher)
- โ ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงูุฎุทุจ
- โ ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงููุญุงุถุฑุงุช
- โ ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงูููุงูุงุช
- โ ุฑูุน ุงููููุงุช ุงูุตูุชูุฉ ูุงููุฑุฆูุฉ
- โ ุฅุฏุงุฑุฉ ุงููุญุชูู ุงูุฎุงุต ุจู

### 2๏ธโฃ ุตูุงุญูุงุช ุงูุนุงูู (Scholar) - ูุจู ุงูุชุฑููุฉ
- โ ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงูุฎุทุจ (ููุณ ุงูุฎุทูุจ)
- โ ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงููุญุงุถุฑุงุช (ููุณ ุงูุฎุทูุจ)
- โ ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงููุชุงูู โญ (ุฎุงุต ุจุงูุนููุงุก)
- โ ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุดุฑุนูุฉ โญ (ุฎุงุต ุจุงูุนููุงุก)

### 3๏ธโฃ ุตูุงุญูุงุช ุงูุนุงูู (Scholar) - ุจุนุฏ ุงูุชุฑููุฉ
- โ **ุฌููุน ุตูุงุญูุงุช ุงูุฎุทูุจ** (ูุถูููุฉ ูู ูู ููุงู)
- โ ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงููุชุงูู โญ
- โ ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุดุฑุนูุฉ โญ
- โ ูุฑุงุฌุนุฉ ูุญุชูู ุงูุฎุทุจุงุก (ุงุฎุชูุงุฑู) โญ
- โ ุตูุงุญูุงุช ุฅุถุงููุฉ ูุณุชูุจููุฉ โญ

---

## ๐ง ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1๏ธโฃ ุฅูุดุงุก ScholarMiddleware ุฌุฏูุฏ

**ุงูููู:** `app/Http/Middleware/ScholarMiddleware.php`

**ุงููุตู:**
- Middleware ุฎุงุต ุจุงูุนููุงุก ููุท (ููุตูุงุญูุงุช ุงูุฅุถุงููุฉ)
- ูุณูุญ ููุท ูู `admin` ู `scholar`
- ููุณุชุฎุฏู ููุตูุญุงุช ุงูุฎุงุตุฉ ุจุงูุนููุงุก (ูุซู ุงููุชุงูู)

**ุงูููุฏ:**
```php
class ScholarMiddleware
{
    public function handle(Request $request, Closure $next)
    {
        // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
        if (!Auth::check()) {
            return redirect()->route('login');
        }

        $user = Auth::user();

        // ุงูุชุญูู ูู ุฃู ุงูุญุณุงุจ ูุดุท
        if (!$user->is_active) {
            Auth::logout();
            return redirect()->route('login')
                ->with('error', 'ุญุณุงุจู ุบูุฑ ูุดุท');
        }

        // ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ุนุงูู ุฃู ูุฏูุฑ ููุท
        $allowedRoles = ['admin', 'scholar'];

        if (!$user->hasAnyRole($allowedRoles)) {
            return response()->view('errors.403', [
                'message' => 'ูุฐู ุงูุตูุญุฉ ูุฎุตุตุฉ ููุนููุงุก ูุงููุฏูุฑูู ููุท'
            ], 403);
        }

        return $next($request);
    }
}
```

**ุงูุงุณุชุฎุฏุงู:**
```php
// ูู routes/web.php
Route::middleware('scholar')->group(function () {
    // ุตูุญุงุช ุฎุงุตุฉ ุจุงูุนููุงุก ููุท (ูุซู ุงููุชุงูู)
    Route::get('/fatwas/create', [FatwaController::class, 'create']);
    Route::post('/fatwas', [FatwaController::class, 'store']);
});
```

---

### 2๏ธโฃ ุชุณุฌูู ScholarMiddleware ูู Kernel

**ุงูููู:** `app/Http/Kernel.php`

**ุงูุชุบููุฑ:**
```php
protected $routeMiddleware = [
    // ... middlewares ุฃุฎุฑู
    'admin' => \App\Http\Middleware\AdminMiddleware::class,
    'preacher' => \App\Http\Middleware\PreacherMiddleware::class,
    'scholar' => \App\Http\Middleware\ScholarMiddleware::class, // โ ุฌุฏูุฏ
];
```

---

### 3๏ธโฃ ุชุญุฏูุซ SermonPreparationController

**ุงูููู:** `app/Http/Controllers/SermonPreparationController.php`

**ุงูุชุบููุฑุงุช:**
- โ ุชุฃููุฏ ุฃู `scholar` ูุฃุชู **ูุจู** `preacher` ูู ุฌููุน ุงููุญูุตุงุช
- โ ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถูุญูุฉ

**ูุจู:**
```php
if (!$user->hasAnyRole(['admin', 'preacher', 'scholar'])) {
    return redirect()->route('home')->with('error', 'ุบูุฑ ูุตุฑุญ ูู');
}
```

**ุจุนุฏ:**
```php
// ููุงุญุธุฉ: ุงูุนุงูู (scholar) ูุฏูู ุฌููุน ุตูุงุญูุงุช ุงูุฎุทูุจ (preacher) + ุตูุงุญูุงุช ุฅุถุงููุฉ
if (!$user->hasAnyRole(['admin', 'scholar', 'preacher'])) {
    return redirect()->route('home')->with('error', 'ุบูุฑ ูุตุฑุญ ูู');
}
```

**ุงูุฃูุงูู ุงููุญุฏุซุฉ:**
1. `create()` - ุฅูุดุงุก ุฎุทุจุฉ ุฌุฏูุฏุฉ (ุงูุณุทุฑ 53-57)
2. `store()` - ุญูุธ ุฎุทุจุฉ ุฌุฏูุฏุฉ (ุงูุณุทุฑ 53-57)
3. `mySermons()` - ุนุฑุถ ุฎุทุจ ุงููุณุชุฎุฏู (ุงูุณุทุฑ 154-158)
4. `edit()` - ุชุนุฏูู ุฎุทุจุฉ (ุงูุณุทุฑ 175-179)
5. `update()` - ุชุญุฏูุซ ุฎุทุจุฉ (ุงูุณุทุฑ 192-196)

---

### 4๏ธโฃ PreacherMiddleware (ุจุฏูู ุชุบููุฑ)

**ุงูููู:** `app/Http/Middleware/PreacherMiddleware.php`

**ุงููุถุน ุงูุญุงูู:**
```php
$allowedRoles = ['admin', 'scholar', 'preacher', 'thinker', 'data_entry'];
```

**ููุงุญุธุฉ:**
- โ `scholar` ููุฌูุฏ ุจุงููุนู
- โ ูุณูุญ ููุนููุงุก ุจุงููุตูู ูุฌููุน ุตูุญุงุช ุงูุฎุทุจุงุก
- โ ูุง ุญุงุฌุฉ ูุชุบููุฑ

---

## ๐ ููุงุฑูุฉ ุงูุตูุงุญูุงุช

| ุงูุตูุงุญูุฉ | Admin | Scholar | Preacher | Thinker | Data Entry | Member |
|----------|-------|---------|----------|---------|------------|--------|
| **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู** | โ | โ | โ | โ | โ | โ |
| **ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ** | โ | โ | โ | โ | โ | โ |
| **ุฅูุดุงุก ุฎุทุจ** | โ | โ | โ | โ | โ | โ |
| **ุฅูุดุงุก ูุญุงุถุฑุงุช** | โ | โ | โ | โ | โ | โ |
| **ุฅูุดุงุก ููุงูุงุช** | โ | โ | โ | โ | โ | โ |
| **ุฅูุดุงุก ูุชุงูู** | โ | โ โญ | โ | โ | โ | โ |
| **ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ** | โ | โ โญ | โ | โ | โ | โ |
| **ูุฑุงุฌุนุฉ ุงููุญุชูู** | โ | โ โญ | โ | โ | โ | โ |
| **ุนุฑุถ ุงููุญุชูู** | โ | โ | โ | โ | โ | โ |
| **ุงูููุถูุงุช** | โ | โ | โ | โ | โ | โ |

**ุงูุฎูุงุตุฉ:**
- โ **Scholar** ูุฏูู ุฌููุน ุตูุงุญูุงุช **Preacher** + ุตูุงุญูุงุช ุฅุถุงููุฉ (โญ)
- โ **Admin** ูุฏูู ุฌููุน ุงูุตูุงุญูุงุช

---

## ๐ฏ ุงูุงุณุชุฎุฏุงู

### ููุตูุญุงุช ุงููุดุชุฑูุฉ (ุฎุทุจุงุก + ุนููุงุก):
```php
// ุงุณุชุฎุฏู PreacherMiddleware (ูุณูุญ ููุนููุงุก ุชููุงุฆูุงู)
Route::middleware('preacher')->group(function () {
    Route::get('/sermons/prepare', [SermonPreparationController::class, 'create']);
    Route::get('/lectures/create', [LectureManagementController::class, 'create']);
});
```

### ููุตูุญุงุช ุงูุฎุงุตุฉ ุจุงูุนููุงุก ููุท:
```php
// ุงุณุชุฎุฏู ScholarMiddleware (ุนููุงุก ููุท)
Route::middleware('scholar')->group(function () {
    Route::get('/fatwas/create', [FatwaController::class, 'create']);
    Route::post('/fatwas', [FatwaController::class, 'store']);
    Route::get('/questions/pending', [QuestionController::class, 'pending']);
});
```

---

## โ ุงูููุงุฆุฏ

### 1. **ูุถูุญ ุงูุตูุงุญูุงุช**
- โ ูุงุถุญ ุฃู ุงูุนุงูู ูุฏูู ุตูุงุญูุงุช ุฃูุซุฑ ูู ุงูุฎุทูุจ
- โ ุณูููุฉ ุฅุถุงูุฉ ุตูุงุญูุงุช ุฌุฏูุฏุฉ ููุนููุงุก

### 2. **ุณูููุฉ ุงูุตูุงูุฉ**
- โ Middleware ูููุตู ููุนููุงุก
- โ ุชุนูููุงุช ูุงุถุญุฉ ูู ุงูููุฏ

### 3. **ุงููุฑููุฉ**
- โ ูููู ุฅุถุงูุฉ ุตูุงุญูุงุช ุฌุฏูุฏุฉ ููุนููุงุก ุจุณูููุฉ
- โ ูุง ุชุฃุซูุฑ ุนูู ุตูุงุญูุงุช ุงูุฎุทุจุงุก

### 4. **ุงูุฃูุงู**
- โ ูุญุต `is_active` ูู ูู middleware
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ุชุฑุชูุจ ุงูุฃุฏูุงุฑ ูู ุงููุญูุตุงุช:

**ุงูุชุฑุชูุจ ุงูููุตู ุจู:**
```php
['admin', 'scholar', 'preacher', 'thinker', 'data_entry']
```

**ุงูุณุจุจ:**
1. `admin` - ุฃุนูู ุตูุงุญูุฉ
2. `scholar` - ุตูุงุญูุงุช ูุงุณุนุฉ (ุฎุทูุจ + ูููู)
3. `preacher` - ุตูุงุญูุงุช ูุชูุณุทุฉ
4. `thinker` - ุตูุงุญูุงุช ูุญุฏูุฏุฉ
5. `data_entry` - ุตูุงุญูุงุช ูุญุฏูุฏุฉ

### โ ูุชู ุชุณุชุฎุฏู ุฃู Middleware:

| Middleware | ุงูุงุณุชุฎุฏุงู | ูุซุงู |
|------------|-----------|------|
| `admin` | ุตูุญุงุช ุงูุฅุฏุงุฑุฉ ููุท | ููุญุฉ ุงูุชุญููุ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู |
| `scholar` | ุตูุญุงุช ุงูุนููุงุก ููุท | ุงููุชุงููุ ุงูุฃุณุฆูุฉ ุงูุดุฑุนูุฉ |
| `preacher` | ุตูุญุงุช ุงูุฎุทุจุงุก ูุงูุนููุงุก | ุงูุฎุทุจุ ุงููุญุงุถุฑุงุชุ ุงูููุงูุงุช |
| `auth` | ุฃู ูุณุชุฎุฏู ูุณุฌู | ุงูููุถูุงุชุ ุงูููู ุงูุดุฎุตู |

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### 1. ุฅุถุงูุฉ ุตูุญุงุช ุงููุชุงูู (ููุนููุงุก ููุท)
```php
Route::middleware('scholar')->group(function () {
    Route::get('/fatwas/create', [FatwaController::class, 'create'])->name('fatwas.create');
    Route::post('/fatwas', [FatwaController::class, 'store'])->name('fatwas.store');
    Route::get('/fatwas/{id}/edit', [FatwaController::class, 'edit'])->name('fatwas.edit');
    Route::put('/fatwas/{id}', [FatwaController::class, 'update'])->name('fatwas.update');
});
```

### 2. ุฅุถุงูุฉ ุตูุญุงุช ุงูุฃุณุฆูุฉ ุงูุดุฑุนูุฉ (ููุนููุงุก ููุท)
```php
Route::middleware('scholar')->group(function () {
    Route::get('/questions/pending', [QuestionController::class, 'pending'])->name('questions.pending');
    Route::post('/questions/{id}/answer', [QuestionController::class, 'answer'])->name('questions.answer');
});
```

### 3. ุฅุถุงูุฉ ุตูุญุฉ ูุฑุงุฌุนุฉ ุงููุญุชูู (ููุนููุงุก ููุท)
```php
Route::middleware('scholar')->group(function () {
    Route::get('/review/sermons', [ReviewController::class, 'sermons'])->name('review.sermons');
    Route::post('/review/sermons/{id}/approve', [ReviewController::class, 'approve'])->name('review.approve');
});
```

---

## ๐ ุงูููุฎุต

| # | ุงูุชุบููุฑ | ุงูููู | ุงูุญุงูุฉ |
|---|---------|-------|--------|
| 1 | ุฅูุดุงุก ScholarMiddleware | `app/Http/Middleware/ScholarMiddleware.php` | โ |
| 2 | ุชุณุฌูู Middleware | `app/Http/Kernel.php` | โ |
| 3 | ุชุญุฏูุซ SermonPreparationController | `app/Http/Controllers/SermonPreparationController.php` | โ |
| 4 | ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถูุญูุฉ | ุฌููุน ุงููููุงุช | โ |
| 5 | ุชูุซูู ุดุงูู | `SCHOLAR_PERMISSIONS_UPGRADE.md` | โ |

---

**ุงูุญุงูุฉ:** โ ููุชูู 100%  
**ุงูุชุฃุซูุฑ:** ๐ข ุฅูุฌุงุจู - ุชุญุณูู ุงููุถูุญ ูุงููุฑููุฉ  
**ุงูุฃูุงู:** โ ูุง ุชุฃุซูุฑ ุณูุจู

**ุงูุขู ุงูุนุงูู (Scholar) ูุฏูู ุฌููุน ุตูุงุญูุงุช ุงูุฎุทูุจ (Preacher) + ุตูุงุญูุงุช ุฅุถุงููุฉ! ๐**

---

**ุชู ุจูุงุณุทุฉ:** ุงูุฎูุงุฑุฒูู - AI Full-Stack Developer  
**ุงูุชุงุฑูุฎ:** 2025-10-25


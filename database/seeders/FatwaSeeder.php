<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Fatwa;
use App\Models\User;

class FatwaSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // الحصول على العلماء
        $scholars = User::role('scholar')->get();
        
        if ($scholars->isEmpty()) {
            $this->command->warn('لا يوجد علماء في قاعدة البيانات. يرجى تشغيل UserSeeder أولاً.');
            return;
        }

        $fatwas = [
            [
                'title' => 'ما حكم الصلاة في البيت بدون عذر؟',
                'question' => 'السلام عليكم ورحمة الله وبركاته، أريد أن أسأل عن حكم الصلاة في البيت بدون عذر شرعي، هل يجوز ذلك؟',
                'answer' => 'وعليكم السلام ورحمة الله وبركاته، الحمد لله والصلاة والسلام على رسول الله وبعد:

صلاة الجماعة في المسجد واجبة على الرجال القادرين، وقد ثبت في الصحيحين أن النبي صلى الله عليه وسلم قال: "من سمع النداء فلم يأته فلا صلاة له إلا من عذر".

والأعذار المبيحة للتخلف عن صلاة الجماعة:
1. المرض
2. الخوف
3. المطر الشديد
4. الظلمة الشديدة
5. رعاية المريض

أما الصلاة في البيت بدون عذر فهي مكروهة كراهة شديدة عند الجمهور، وذهب بعض العلماء إلى تحريمها.

والله أعلم.',
                'category' => 'worship',
                'tags' => ['صلاة', 'جماعة', 'مسجد'],
                'is_published' => true,
                'is_featured' => true,
            ],
            [
                'title' => 'ما حكم الزكاة على الذهب المدخر؟',
                'question' => 'عندي ذهب مدخر للزينة، هل عليه زكاة؟',
                'answer' => 'الحمد لله والصلاة والسلام على رسول الله وبعد:

الذهب المدخر للزينة اختلف فيه العلماء:

**القول الأول:** تجب فيه الزكاة مطلقاً
- وهو قول جمهور العلماء
- لعموم الأدلة الدالة على وجوب الزكاة في الذهب

**القول الثاني:** لا تجب فيه الزكاة
- وهو قول بعض العلماء
- لأنه معد للاستعمال لا للتجارة

**الراجح:**
القول الأول أحوط وأبرأ للذمة، فإذا بلغ النصاب (85 جراماً) وحال عليه الحول وجبت فيه الزكاة بنسبة 2.5%.

والله أعلم.',
                'category' => 'worship',
                'tags' => ['زكاة', 'ذهب', 'مال'],
                'is_published' => true,
                'is_featured' => false,
            ],
            [
                'title' => 'ما حكم البيع بالتقسيط؟',
                'question' => 'هل يجوز البيع بالتقسيط بسعر أعلى من السعر النقدي؟',
                'answer' => 'الحمد لله والصلاة والسلام على رسول الله وبعد:

البيع بالتقسيط جائز شرعاً بشروط:

**الشروط:**
1. أن يكون الثمن محدداً ومعلوماً
2. أن تكون الأقساط محددة ومعلومة
3. أن لا يزاد في الثمن إذا تأخر المشتري عن السداد
4. أن يكون العقد واضحاً لا غرر فيه

**الحكم:**
يجوز أن يكون سعر التقسيط أعلى من السعر النقدي، لأن الأجل له قيمة في الشرع.

**الدليل:**
قال تعالى: {وَأَحَلَّ اللَّهُ الْبَيْعَ وَحَرَّمَ الرِّبَا}

والله أعلم.',
                'category' => 'transactions',
                'tags' => ['بيع', 'تقسيط', 'معاملات'],
                'is_published' => true,
                'is_featured' => true,
            ],
            [
                'title' => 'ما حكم الطلاق الشفوي؟',
                'question' => 'هل يقع الطلاق إذا قاله الرجل في حالة غضب؟',
                'answer' => 'الحمد لله والصلاة والسلام على رسول الله وبعد:

الطلاق في حالة الغضب له أحوال:

**الحالة الأولى:** الغضب الشديد الذي يفقد معه الإنسان وعيه
- لا يقع الطلاق
- لأنه في حكم المجنون

**الحالة الثانية:** الغضب المتوسط الذي لا يفقد معه الوعي
- يقع الطلاق عند جمهور العلماء
- لأنه مكلف عاقل

**الحالة الثالثة:** الغضب اليسير
- يقع الطلاق بالإجماع

**تنبيه مهم:**
الطلاق أمر خطير، ولا ينبغي التسرع فيه، وينصح بمراجعة العلماء قبل اتخاذ أي قرار.

والله أعلم.',
                'category' => 'family',
                'tags' => ['طلاق', 'أسرة', 'زواج'],
                'is_published' => true,
                'is_featured' => false,
            ],
            [
                'title' => 'ما حكم استخدام وسائل التواصل الاجتماعي؟',
                'question' => 'ما حكم استخدام وسائل التواصل الاجتماعي مثل فيسبوك وتويتر؟',
                'answer' => 'الحمد لله والصلاة والسلام على رسول الله وبعد:

وسائل التواصل الاجتماعي وسيلة محايدة، والحكم يتعلق بالاستخدام:

**الاستخدام المباح:**
1. التواصل مع الأهل والأصدقاء
2. نشر العلم النافع
3. الدعوة إلى الله
4. التجارة المشروعة

**الاستخدام المحرم:**
1. نشر الفواحش والمنكرات
2. الغيبة والنميمة
3. إضاعة الوقت فيما لا ينفع
4. الاختلاط المحرم

**الضوابط:**
- الالتزام بالآداب الشرعية
- عدم إضاعة الوقت
- الحذر من الفتن
- حفظ الخصوصية

والله أعلم.',
                'category' => 'contemporary',
                'tags' => ['تكنولوجيا', 'معاصر', 'إنترنت'],
                'is_published' => true,
                'is_featured' => true,
            ],
        ];

        foreach ($fatwas as $fatwaData) {
            // اختيار عالم عشوائي
            $scholar = $scholars->random();
            
            Fatwa::create([
                'title' => $fatwaData['title'],
                'question' => $fatwaData['question'],
                'answer' => $fatwaData['answer'],
                'category' => $fatwaData['category'],
                'tags' => $fatwaData['tags'],
                'scholar_id' => $scholar->id,
                'is_published' => $fatwaData['is_published'],
                'is_featured' => $fatwaData['is_featured'],
                'published_at' => now(),
                'views_count' => rand(10, 500),
                'likes_count' => rand(0, 50),
            ]);
        }

        $this->command->info('تم إنشاء ' . count($fatwas) . ' فتوى بنجاح!');
    }
}


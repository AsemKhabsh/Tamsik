# ุฅุตูุงุญ ุฎุทุฃ ุทุฑุญ ุงูุฃุณุฆูุฉ - Ask Question Bug Fix

## ุงูุชุงุฑูุฎ: 2025-10-25

---

## ๐ ุงููุดููุฉ

### ุงูุฎุทุฃ:
```
SQLSTATE[23000]: Integrity constraint violation: 1048 Column 'answer' cannot be null
```

### ุงููุตู:
ุนูุฏ ูุญุงููุฉ ุทุฑุญ ุณุคุงู ุฌุฏูุฏ ูู ุญุณุงุจ ุนุถูุ ูุงู ูุธูุฑ ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุน ุญูุธ ุงูุณุคุงู.

### ุงูุณุจุจ:
ูู ุฌุฏูู `fatwas`ุ ูุงู ุญูู `answer` ูุนุฑูู ุนูู ุฃูู `NOT NULL`ุ ุจูููุง ุงูุฃุณุฆูุฉ ุงูุฌุฏูุฏุฉ ูุง ุชุญุชูู ุนูู ุฅุฌุงุจุฉ ุจุนุฏ.

---

## โ ุงูุญู

### 1. ุฌุนู ุญูู `answer` ูุงุจู ูููููุฉ NULL

ุชู ุฅูุดุงุก migration ุฌุฏูุฏ ูุชุนุฏูู ุญูู `answer`:

**ุงูููู**: `database/migrations/2025_10_25_000002_make_answer_nullable_in_fatwas_table.php`

```php
public function up(): void
{
    Schema::table('fatwas', function (Blueprint $table) {
        $table->longText('answer')->nullable()->change();
    });
}
```

### 2. ุฌุนู ุญูู `scholar_id` ูุงุจู ูููููุฉ NULL

ุชู ุฅูุดุงุก migration ุฌุฏูุฏ ูุชุนุฏูู ุญูู `scholar_id`:

**ุงูููู**: `database/migrations/2025_10_25_000003_make_scholar_id_nullable_in_fatwas_table.php`

```php
public function up(): void
{
    // ุญุฐู foreign key constraint ุฃููุงู
    Schema::table('fatwas', function (Blueprint $table) {
        $table->dropForeign(['scholar_id']);
    });

    // ุชุนุฏูู ุงูุนููุฏ ููููู nullable
    Schema::table('fatwas', function (Blueprint $table) {
        $table->foreignId('scholar_id')->nullable()->change();
    });

    // ุฅุนุงุฏุฉ ุฅุถุงูุฉ foreign key constraint
    Schema::table('fatwas', function (Blueprint $table) {
        $table->foreign('scholar_id')
              ->references('id')
              ->on('users')
              ->onDelete('set null');
    });
}
```

---

## ๐ ุงูุชุบููุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ูุจู ุงูุฅุตูุงุญ:
```sql
CREATE TABLE fatwas (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    question TEXT NOT NULL,
    answer LONGTEXT NOT NULL,  -- โ NOT NULL
    category VARCHAR(255) NOT NULL,
    scholar_id BIGINT UNSIGNED NOT NULL,  -- โ NOT NULL
    ...
);
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```sql
CREATE TABLE fatwas (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    question TEXT NOT NULL,
    answer LONGTEXT NULL,  -- โ NULLABLE
    category VARCHAR(255) NOT NULL,
    scholar_id BIGINT UNSIGNED NULL,  -- โ NULLABLE
    ...
);
```

---

## ๐ ุชูููุฐ ุงูุฅุตูุงุญ

### ุงูุฃูุงูุฑ ุงููุณุชุฎุฏูุฉ:
```bash
php artisan migrate
```

### ุงููุชูุฌุฉ:
```
INFO  Running migrations.

2025_10_25_000002_make_answer_nullable_in_fatwas_table ................... 381ms DONE
2025_10_25_000003_make_scholar_id_nullable_in_fatwas_table ............... 545ms DONE
```

---

## ๐ ููุทู ุงููุธุงู

### ุนูุฏ ุทุฑุญ ุณุคุงู ุฌุฏูุฏ:

#### 1. ุงููุณุชุฎุฏู ูููุฃ ุงููููุฐุฌ:
- โ ุนููุงู ุงูุณุคุงู (ูุทููุจ)
- โ ูุต ุงูุณุคุงู (ูุทููุจ)
- โ ุงูุชุตููู (ูุทููุจ)
- โช ุงูุนุงูู ุงููุทููุจ (ุงุฎุชูุงุฑู)

#### 2. ูุชู ุญูุธ ุงูุณุคุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```php
Fatwa::create([
    'title' => $request->title,
    'question' => $request->question,
    'category' => $request->category,
    'scholar_id' => $request->scholar_id,  // ูุฏ ูููู NULL
    'questioner_id' => Auth::id(),
    'answer' => null,  // โ NULL ุญุชู ูุฌูุจ ุงูุนุงูู
    'is_published' => false,
]);
```

#### 3. ุญุงูุงุช ุงูุณุคุงู:

**ุญุงูุฉ 1: ุณุคุงู ุฌุฏูุฏ (ููุฏ ุงูุงูุชุธุงุฑ)**
```
answer = NULL
is_published = false
scholar_id = NULL ุฃู ูุนุฑู ุนุงูู ูุญุฏุฏ
```

**ุญุงูุฉ 2: ูุณูุฏุฉ ุฅุฌุงุจุฉ**
```
answer = "ูุต ุงูุฅุฌุงุจุฉ"
is_published = false
scholar_id = ูุนุฑู ุงูุนุงูู
```

**ุญุงูุฉ 3: ุฅุฌุงุจุฉ ููุดูุฑุฉ**
```
answer = "ูุต ุงูุฅุฌุงุจุฉ"
is_published = true
published_at = ุชุงุฑูุฎ ุงููุดุฑ
scholar_id = ูุนุฑู ุงูุนุงูู
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุทุฑุญ ุณุคุงู ุจุฏูู ุชุญุฏูุฏ ุนุงูู
```
1. ุชุณุฌูู ุฏุฎูู ูุนุถู
2. ุงูุฐูุงุจ ุฅูู /ask-question
3. ููุก ุงููููุฐุฌ:
   - ุงูุนููุงู: "ูุง ุญูู ุตูุงุฉ ุงูุฌูุนุฉุ"
   - ุงูุณุคุงู: "ุฃุฑูุฏ ูุนุฑูุฉ ุญูู ุตูุงุฉ ุงูุฌูุนุฉ..."
   - ุงูุชุตููู: "ุนุจุงุฏุงุช"
   - ุงูุนุงูู: (ูุงุฑุบ)
4. ุฅุฑุณุงู ุงูุณุคุงู
5. โ ูุฌุจ ุฃู ูุชู ุญูุธ ุงูุณุคุงู ุจูุฌุงุญ
```

### ุงุฎุชุจุงุฑ 2: ุทุฑุญ ุณุคุงู ูุน ุชุญุฏูุฏ ุนุงูู
```
1. ุชุณุฌูู ุฏุฎูู ูุนุถู
2. ุงูุฐูุงุจ ุฅูู /ask-question
3. ููุก ุงููููุฐุฌ:
   - ุงูุนููุงู: "ูุง ุญูู ุงูุฒูุงุฉุ"
   - ุงูุณุคุงู: "ุฃุฑูุฏ ูุนุฑูุฉ ุญูู ุงูุฒูุงุฉ..."
   - ุงูุชุตููู: "ูุนุงููุงุช"
   - ุงูุนุงูู: "ุงูุดูุฎ ูุญูุฏ"
4. ุฅุฑุณุงู ุงูุณุคุงู
5. โ ูุฌุจ ุฃู ูุชู ุญูุธ ุงูุณุคุงู ุจูุฌุงุญ
```

### ุงุฎุชุจุงุฑ 3: ุนุฑุถ ุงูุฃุณุฆูุฉ ูู ููุญุฉ ุงูุนุงูู
```
1. ุชุณุฌูู ุฏุฎูู ูุนุงูู
2. ุงูุฐูุงุจ ุฅูู /scholar/dashboard
3. โ ูุฌุจ ุฃู ุชุธูุฑ ุงูุฃุณุฆูุฉ ููุฏ ุงูุงูุชุธุงุฑ
4. โ ูุฌุจ ุฃู ุชุธูุฑ ุงูุฃุณุฆูุฉ ุงูุชู answer = NULL
```

### ุงุฎุชุจุงุฑ 4: ุงูุฅุฌุงุจุฉ ุนูู ุณุคุงู
```
1. ุชุณุฌูู ุฏุฎูู ูุนุงูู
2. ุงูุฐูุงุจ ุฅูู /scholar/questions
3. ุงุฎุชูุงุฑ ุณุคุงู ููุฏ ุงูุงูุชุธุงุฑ
4. ูุชุงุจุฉ ุฅุฌุงุจุฉ
5. ูุดุฑ ุงูุฅุฌุงุจุฉ
6. โ ูุฌุจ ุฃู ูุชู ุชุญุฏูุซ answer ู is_published
```

---

## ๐ ุงูุชุญูู ูู ุงูุฅุตูุงุญ

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
-- ุงูุชุญูู ูู ุฃู answer ุฃุตุจุญ nullable
DESCRIBE fatwas;

-- ูุฌุจ ุฃู ูุธูุฑ:
-- answer | longtext | YES | | NULL |

-- ุงูุชุญูู ูู ุฃู scholar_id ุฃุตุจุญ nullable
-- ูุฌุจ ุฃู ูุธูุฑ:
-- scholar_id | bigint unsigned | YES | MUL | NULL |
```

### ูู ุงูููุฏ:
```php
// ูู FatwaService::createQuestion()
$fatwa = Fatwa::create(array_merge($data, [
    'is_published' => false,
    'answer' => null,  // โ ูุนูู ุงูุขู
]));
```

---

## ๐ ุชุฃุซูุฑ ุงูุฅุตูุงุญ

### ูุจู ุงูุฅุตูุงุญ:
- โ ูุง ูููู ุทุฑุญ ุฃุณุฆูุฉ ุฌุฏูุฏุฉ
- โ ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ูููู ุทุฑุญ ุฃุณุฆูุฉ ุฌุฏูุฏุฉ
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ
- โ ูููู ุชุญุฏูุฏ ุนุงูู ุฃู ุชุฑูู ูุงุฑุบุงู
- โ ุงูุนุงูู ููููู ุฑุคูุฉ ุงูุฃุณุฆูุฉ ูุงูุฅุฌุงุจุฉ ุนูููุง

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ

1. โ `database/migrations/2025_10_25_000002_make_answer_nullable_in_fatwas_table.php`
2. โ `database/migrations/2025_10_25_000003_make_scholar_id_nullable_in_fatwas_table.php`

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ:
ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช ููุฌูุฏุฉ ูู ุฌุฏูู `fatwas` ุจุฏูู `answer`ุ ููุฏ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุซูุง:
```sql
UPDATE fatwas SET answer = NULL WHERE answer = '';
```

### 2. ุงูู Validation:
ุงูููุฏ ุงูุญุงูู ูุง ูุชุทูุจ `answer` ุนูุฏ ุฅูุดุงุก ุณุคุงู ุฌุฏูุฏุ ููุฐุง ุตุญูุญ.

### 3. ุงูู Foreign Key:
ุชู ุชุบููุฑ `onDelete` ูู `cascade` ุฅูู `set null` ูู `scholar_id`ุ ููุง ูุนูู:
- ุฅุฐุง ุชู ุญุฐู ุงูุนุงููุ ุณูุชู ุชุนููู `scholar_id` ุฅูู `NULL` ุจุฏูุงู ูู ุญุฐู ุงูุณุคุงู

---

## โ ุงูุญุงูุฉ

**ุงูุชุงุฑูุฎ**: 2025-10-25  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ  
**ุงูุงุฎุชุจุงุฑ**: โณ ูุญุชุงุฌ ุงุฎุชุจุงุฑ  
**ุงูุชุฃุซูุฑ**: ๐ข ุฅูุฌุงุจู - ูุญู ูุดููุฉ ุญุฑุฌุฉ

---

## ๐ฏ ุงููุชูุฌุฉ

- โ ูููู ุงูุขู ุทุฑุญ ุฃุณุฆูุฉ ุฌุฏูุฏุฉ ุจูุฌุงุญ
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงููุธุงู ูุนูู ููุง ูู ูุชููุน
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณููุฉ

---

**ุงููุทูุฑ**: Augment Agent  
**ุงูุชุงุฑูุฎ**: 2025-10-25

